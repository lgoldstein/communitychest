-- Used to enforce the enum values of UserRoleType
CREATE TABLE LutUserRoleType (
	name VARCHAR(16),
	
	PRIMARY KEY(name)
);

CREATE TABLE User (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1),
	version INTEGER DEFAULT 0 NOT NULL,
	name VARCHAR(255) UNIQUE NOT NULL,
	loginName VARCHAR(64) UNIQUE NOT NULL,
	password VARCHAR(64) NOT NULL,
	role VARCHAR(16) NOT NULL REFERENCES LutUserRoleType(name),
	homeAddress VARCHAR(1024) NOT NULL,
	latitude VARCHAR(64),
	longitude VARCHAR(64),
	elevation VARCHAR(64),

	PRIMARY KEY(id)
);

CREATE TABLE Bank (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1),
	version INTEGER DEFAULT 0 NOT NULL,
	name VARCHAR(255) UNIQUE NOT NULL,
	bankCode INTEGER UNIQUE NOT NULL,
	hqAddress VARCHAR(1024) NOT NULL,
	latitude VARCHAR(64),
	longitude VARCHAR(64),
	elevation VARCHAR(64),

	PRIMARY KEY(id)
);

CREATE TABLE Branch (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1),
	version INTEGER DEFAULT 0 NOT NULL,
	name VARCHAR(255) UNIQUE NOT NULL,
	bankId BIGINT NOT NULL REFERENCES Bank(id),
	branchCode INTEGER NOT NULL,
	location VARCHAR(1024) NOT NULL,
	latitude VARCHAR(64),
	longitude VARCHAR(64),
	elevation VARCHAR(64),

	PRIMARY KEY(id),
	UNIQUE(bankId,branchCode)
);

CREATE TABLE Account (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1),
	version INTEGER DEFAULT 0 NOT NULL,
	ownerId BIGINT NOT NULL REFERENCES User(id),
	branchId BIGINT NOT NULL REFERENCES Branch(id),
	accountNumber VARCHAR(64) NOT NULL,
	amount INTEGER NOT NULL,

	PRIMARY KEY(id),
	UNIQUE(ownerId,branchId,accountNumber)
);